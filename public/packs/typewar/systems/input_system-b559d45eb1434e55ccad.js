!function(e){function t(r){if(n[r])return n[r].exports;var s=n[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=29)}({16:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CMD_CHANGE_STANCE",function(){return r}),n.d(t,"COMMANDS",function(){return s});var r="change stance",s={tab:r}},29:function(e,t,n){"use strict";function r(e){e("BattlePlayer").addComponent("BattleInput").battleInput()}function s(e){var t,n,r,s;t=e("BattleInput BattleStance").get(),t.length<1||(n=t[0],r=n.getInputQueue(),0!=r.length&&(r.forEach(function(e){k(e,n)||(s=c(n),s=o(s),s=h(s),s=d(s),l(e,s))}),n.clearInputQueue()))}function i(){var e;e=y(Crafty("TextFragment").get()),e.forEach(function(e){e.cancel()})}function a(e){i(),e.toggleStance(),e.setStatusDirty()}function u(){return Crafty("TextFragment BattlePCSkill").get()}function f(){return Crafty("TextFragment DefendableAttack").get()}function c(e){if(e.isStance("offense"))return u();if(e.isStance("defense"))return f();throw new Error("Input entity is in an invalid stance")}function y(e){return _.filter(e,function(e){return e.isActive()})}function o(e){return _.filter(e,function(e){return!e.isComplete()})}function h(e){return _.filter(e,function(e){return!e.isCooling()})}function d(e){return _.filter(e,function(e){return!e.isProcessed()})}function k(e,t){switch(e){case C.CMD_CHANGE_STANCE:return a(t),!0;default:return!1}}function l(e,t){var n,r,s;if(n=y(t),_.isEmpty(n))return s=_.filter(t,function(t){return t.matchFirstChar(e)}),void s.forEach(function(t){t.activate(),t.acceptInput(e)});if(1==n.length)return void n[0].acceptInput(e);if(r=_.filter(n,function(t){return t.matchNextChar(e)}),0==r.length);else{if(!(r.length>=1))throw new Error("Error, something funky is going on here....");n.forEach(function(t){t.matchNextChar(e)?t.acceptInput(e):t.cancel()})}}Object.defineProperty(t,"__esModule",{value:!0});var C=n(16);t.initInputSystem=r,t.inputSystem=s,n(46)},46:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16);Crafty.c("BattleInput",{init:function(){this._inputQueue=[],this.is_shift_key_down=!1},battleInput:function(){return this._attachKeyboardHandler(),this},clearInputQueue:function(){this._inputQueue=[]},getInputQueue:function(){return this._inputQueue},remove:function(e){this._detachKeyboardHandler()},_attachKeyboardHandler:function(){this.bind("KeyDown",this._handleKeyPress),this.bind("KeyUp",this._handleKeyRelease),this._handleBrowserKeyOverrides()},_detachKeyboardHandler:function(){this.unbind("KeyDown",this._handleKeyPress),this.unbind("KeyUp",this._handleKeyRelease),this._unbindBrowserKeyOverrides()},_handleBrowserKeyOverrides:function(){this._preventBackspaceNavigation(),this._preventTabFieldSwitch(),this._preventSpacebarScroll()},_handleKeyPress:function(e){var t;if(!Crafty.isPaused()){if(t=this._translateKeyToLetter(e.key),this._isModifierKey(t))return this._handleModifierKeyPressed(t);this._inputQueue.push(t)}},_handleKeyRelease:function(e){var t;Crafty.isPaused()||(t=this._translateKeyToLetter(e.key),this._isModifierKey(t)&&this._handleModifierKeyReleased(t))},_handleModifierKeyPressed:function(e){switch(e){case"shift":this.is_shift_key_down=!0;default:return!1}},_handleModifierKeyReleased:function(e){switch(e){case"shift":this.is_shift_key_down=!1;default:return!1}},_isModifierKey:function(e){switch(e){case"shift":return!0;default:return!1}},_preventBackspaceNavigation:function(){$(document).on("keydown",function(e){8!==e.which||$(e.target).is("input, textarea")||e.preventDefault()})},_preventTabFieldSwitch:function(){$(document).on("keydown",function(e){9!==e.which||$(e.target).is("input, textarea")||e.preventDefault()})},_preventSpacebarScroll:function(){$(document).on("keydown",function(e){32!==e.which||$(e.target).is("input, textarea")||e.preventDefault()})},_translateKeyToLetter:function(e){switch(e){case Crafty.keys.BACKSPACE:return"";case Crafty.keys.TAB:return r.COMMANDS.tab;case Crafty.keys.ENTER:return"";case Crafty.keys.SPACE:return" ";case Crafty.keys[0]:return"0";case Crafty.keys[1]:return this.is_shift_key_down?"!":"1";case Crafty.keys[2]:return"2";case Crafty.keys[3]:return"3";case Crafty.keys[4]:return"4";case Crafty.keys[5]:return"5";case Crafty.keys[6]:return"6";case Crafty.keys[7]:return"7";case Crafty.keys[8]:return"8";case Crafty.keys[9]:return"9";case Crafty.keys.A:return this.is_shift_key_down?"A":"a";case Crafty.keys.B:return this.is_shift_key_down?"B":"b";case Crafty.keys.C:return this.is_shift_key_down?"C":"c";case Crafty.keys.D:return this.is_shift_key_down?"D":"d";case Crafty.keys.E:return this.is_shift_key_down?"E":"e";case Crafty.keys.F:return this.is_shift_key_down?"F":"f";case Crafty.keys.G:return this.is_shift_key_down?"G":"g";case Crafty.keys.H:return this.is_shift_key_down?"H":"h";case Crafty.keys.I:return this.is_shift_key_down?"I":"i";case Crafty.keys.J:return this.is_shift_key_down?"J":"j";case Crafty.keys.K:return this.is_shift_key_down?"K":"k";case Crafty.keys.L:return this.is_shift_key_down?"L":"l";case Crafty.keys.M:return this.is_shift_key_down?"M":"m";case Crafty.keys.N:return this.is_shift_key_down?"N":"n";case Crafty.keys.O:return this.is_shift_key_down?"O":"o";case Crafty.keys.P:return this.is_shift_key_down?"P":"p";case Crafty.keys.Q:return this.is_shift_key_down?"Q":"q";case Crafty.keys.R:return this.is_shift_key_down?"R":"r";case Crafty.keys.S:return this.is_shift_key_down?"S":"s";case Crafty.keys.T:return this.is_shift_key_down?"T":"t";case Crafty.keys.U:return this.is_shift_key_down?"U":"u";case Crafty.keys.V:return this.is_shift_key_down?"V":"v";case Crafty.keys.W:return this.is_shift_key_down?"W":"w";case Crafty.keys.X:return this.is_shift_key_down?"X":"x";case Crafty.keys.Y:return this.is_shift_key_down?"Y":"y";case Crafty.keys.Z:return this.is_shift_key_down?"Z":"z";case Crafty.keys.DECIMAL:return".";case Crafty.keys.SHIFT:return"shift";case Crafty.keys.COMMA:return",";case Crafty.keys.MINUS:return"-";case 186:return this.is_shift_key_down?":":";";case 190:return".";case 191:return"?";case 222:return"'";default:return""}},_unbindBrowserKeyOverrides:function(){$(document).off("keydown")}})}});